<link rel="import" href="../bower_components/google-map/google-map-elements.html">
<link rel="import" href="services/dp-service-geo-helper.html">

<dom-module id="dp-home-page">
    <template>
        <style include="dp-styles">
            .map-section {
                height: 100vh;
                width: 100vw;
                position: relative;
            }

            .search-bar {
                margin: 1em 1em 0;
            }

                .search-bar .search-box {
                    padding: 0 0.1%;
                    border-radius: 0;
                    background-color: #fff;
                    width: 100%;
                }
        </style>
        <div class="map-section">
            <dp-service-geo-helper id="geoService"></dp-service-geo-helper>
            <google-map latitude="[[lat]]" longitude="[[lng]]"
                          fit-to-marker api-key="AIzaSyDN1-5T5UmXbJLxj-wf56e_Mh4h32w11vQ">
                <google-map-marker latitude="[[lat]]" longitude="[[lng]]"></google-map-marker>
            </google-map>
            <div class="fixed-top">
                <div class="search-bar">
                    <div class="layout horizontal">
                        <paper-input placeholder="restaurants, hair salon" class="search-box"
                                     no-label-float always-float-label></paper-input>
                        <paper-button class="btn btn-default" raised>
                            <i class="md-icon">search</i>
                        </paper-button>
                        <paper-button class="btn btn-default" raised on-tap="_positionMe">
                            <i class="md-icon">location_on</i>
                        </paper-button>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <script>
        class DpHomePage extends Polymer.Element {
            static get is() { return 'dp-home-page'; }
            static get properties() {
                return {
                    lng: String,
                    lat: String
                };
            }
            connectedCallback() {
                super.connectedCallback();
            }
            _positionMe(e) {
                DpServiceGeoHelper.LongLat.then(e => {
                    console.log(e);
                    this.setProperties({
                        lat: e.latitude,
                        lng: e.longitude
                    });
                }).catch(e => {
                    //TODO: handle no location service
                });
            }
        }

        window.customElements.define(DpHomePage.is, DpHomePage);
    </script>
</dom-module>
